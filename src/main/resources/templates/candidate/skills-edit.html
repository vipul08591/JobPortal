<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Edit Skills</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-white shadow-md sticky top-0 z-10">
    <div class="max-w-6xl mx-auto px-8 py-5 flex justify-between items-center">
        <h1 class="text-3xl font-bold text-blue-700">
            <a th:href="@{/candidate/dashboard}">Job Portal</a>
        </h1>
        <div class="flex items-center gap-6 text-lg">
            <a th:href="@{/candidate/applications}" class="text-gray-700 hover:text-blue-700 font-medium">Applied Jobs</a>
            <a th:href="@{/candidate/profile}" class="text-gray-700 hover:text-blue-700 font-medium">Profile</a>
        </div>
    </div>
</nav>

<main class="max-w-4xl mx-auto px-8 py-10 flex-1">
    <div class="bg-white rounded-3xl shadow-2xl p-10">
        <h2 class="text-3xl font-bold mb-8 text-gray-800">Edit Skills</h2>

        <!-- Messages -->
        <div th:if="${successMessage}" class="bg-green-100 text-green-800 px-5 py-3 rounded mb-6 text-lg">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="bg-red-100 text-red-800 px-5 py-3 rounded mb-6 text-lg">
            <span th:text="${errorMessage}"></span>
        </div>

        <form th:action="@{/candidate/profile/skills/update}" method="post" onsubmit="return validateSkills()">
            <!-- Input for typing skills -->
            <div class="mb-6 relative">
                <input id="skillInput" type="text" placeholder="Type a skill"
                       class="border border-gray-300 rounded-full px-5 py-3 w-full text-lg focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-sm"
                       oninput="showSuggestions(this.value)">
                <div id="suggestionBox" class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-lg shadow-lg max-h-52 overflow-auto z-50 hidden"></div>
            </div>

            <!-- Container for skill chips (flex-wrap) -->
            <div id="skillsContainer" class="flex flex-wrap gap-3 mb-6">
                <div th:each="skill : ${profile.skills}" class="flex items-center gap-2 bg-blue-100 text-blue-800 px-4 py-2 rounded-full shadow-sm text-lg hover:bg-blue-200 transition">
                    <span th:text="${skill}"></span>
                    <button type="button" onclick="removeSkill(this)" class="text-red-600 font-bold text-xl hover:text-red-700">×</button>
                    <input type="hidden" name="skills" th:value="${skill}">
                </div>
            </div>

            <div class="flex justify-end gap-4">
                <button type="submit" class="px-6 py-3 bg-blue-600 text-white text-lg rounded-full hover:bg-blue-700 font-semibold shadow-lg transition">
                    Save
                </button>
                <a th:href="@{/candidate/profile}" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-full text-lg hover:bg-gray-400 transition">
                    Back
                </a>
            </div>
        </form>
    </div>
</main>

<script>
// Predefined skills for suggestion
const predefinedSkills = [
    "Java","Python","JavaScript","C++","C#","HTML","CSS","SQL",
    "Spring Boot","React","Angular","AWS","Docker","Kubernetes",
    "Git","Machine Learning","Data Analysis","Communication","Leadership"
];

const skillInput = document.getElementById('skillInput');
const suggestionBox = document.getElementById('suggestionBox');
const skillsContainer = document.getElementById('skillsContainer');

// Show suggestions below input
function showSuggestions(value) {
    suggestionBox.innerHTML = '';
    if (!value) {
        suggestionBox.classList.add('hidden');
        return;
    }

    const val = value.toLowerCase();
    const filtered = predefinedSkills.filter(s => s.toLowerCase().startsWith(val));
    if (filtered.length === 0) {
        suggestionBox.classList.add('hidden');
        return;
    }

    filtered.forEach(skill => {
        const div = document.createElement('div');
        div.textContent = skill;
        div.className = "px-4 py-2 cursor-pointer hover:bg-blue-100 text-lg";
        div.onclick = () => addSkillChip(skill);
        suggestionBox.appendChild(div);
    });
    suggestionBox.classList.remove('hidden');
}

// Add skill when pressing Enter
skillInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        const value = skillInput.value.trim();
        if (value) addSkillChip(value);
    }
});

// Create a skill chip
function addSkillChip(skill) {
    const existing = Array.from(skillsContainer.querySelectorAll('input[name="skills"]')).map(i => i.value.toLowerCase());
    if (existing.includes(skill.toLowerCase())) {
        skillInput.value = '';
        suggestionBox.classList.add('hidden');
        return;
    }

    if (!/^[A-Za-z\s]+$/.test(skill)) {
        alert("Skill can contain only letters and spaces.");
        return;
    }

    const div = document.createElement('div');
    div.className = "flex items-center gap-2 bg-blue-100 text-blue-800 px-4 py-2 rounded-full shadow-sm text-lg hover:bg-blue-200 transition";

    const span = document.createElement('span');
    span.textContent = skill;

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = "text-red-600 font-bold text-xl hover:text-red-700";
    btn.textContent = "×";
    btn.onclick = () => div.remove();

    const hidden = document.createElement('input');
    hidden.type = 'hidden';
    hidden.name = 'skills';
    hidden.value = skill;

    div.appendChild(span);
    div.appendChild(btn);
    div.appendChild(hidden);

    skillsContainer.appendChild(div);

    skillInput.value = '';
    suggestionBox.classList.add('hidden');
}

// Remove skill
function removeSkill(button) {
    button.parentElement.remove();
}

// Validate before submit
function validateSkills() {
    const skills = document.querySelectorAll('input[name="skills"]');
    if (skills.length === 0) {
        alert("Please add at least one skill.");
        return false;
    }
    return true;
}

// Close suggestion when clicking outside
document.addEventListener('click', function(e) {
    if (!skillInput.contains(e.target) && !suggestionBox.contains(e.target)) {
        suggestionBox.classList.add('hidden');
    }
});
</script>

</body>
</html>
